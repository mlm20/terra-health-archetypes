# 🧬 Health Archetypes – Local Demo Spec (LLM + Image Gen Edition)

A fast, privacy-first, no-login web demo where users connect their wearable, get a one-of-a-kind **Health Archetype**, and copy a beautifully generated card to share with friends.

---

## 🧠 Overview

**Tagline:**

> A unique health vibe, powered by your real data.

**Core experience:**

1. User connects their wearable (via Terra)
2. AI analyzes their health data
3. A custom archetype + avatar is generated
4. Data is deleted — session-based only, no tracking

---

## 🎨 Copy & Tone

**Voice:**

- Playful, creative, non-judgemental
- Inspired by video game classes, MBTI, and personality types
- Avoid clinical terms like "score", "diagnosis", or "medical condition"

**Tone examples:**

- "A snapshot of your fitness energy."
- "You're more than your stats. But here's your style."
- "Your data? Already wiped like a pro cooldown stretch."

---

## 🖼️ App Flow

### Frame 1: Landing Page

- 📝 Light intro explaining:

  - No login or signup
  - Just one personalized profile
  - Everything is local and deleted after

- 🟢 CTA: "Connect Your Wearable" (launches Terra Widget)

---

### Frame 2: Progress Stepper

Stepper shows live feedback through the following phases:

| Step | Label                | Copy                                                   |
| ---- | -------------------- | ------------------------------------------------------ |
| 1    | Device Connected     | "Wearable linked — syncing your data flow 🛰️"          |
| 2    | Health Data Obtained | "Cracking open your past workouts, sleep, and vitals…" |
| 3    | Archetype Discovered | "Channeling your energy into a one-of-a-kind vibe… 🧘‍♂️" |
| 4    | Data Cleared         | "Data deleted. Nothing saved. You're all set 🧼"       |

---

### Frame 3: Archetype Card

**Displays:**

- 🧠 Generated **Archetype Name** and Description
- 🖼 **Low-poly AI-generated image** of the character
- 🎚 **5 consistent health trait sliders**
- 🧍 Optional name (entered by user)
- 📤 CTA: "Copy My Archetype" → converts the card to PNG and copies to clipboard

---

## 🖼 Archetype Design System

Generated by an LLM (e.g. GPT-4 or Gemini) using a structured system prompt and real health data.

**Always includes:**

- Archetype Name (max 3 words)
- Short description
- 5 key slider values (0–100)
- AI Image prompt (low-poly style)

---

## 🎚 The 5 Sliders (Static Dimensions)

These are the **same across all users** but each archetype reflects unique values.

| Slider               | What it captures                                      |
| -------------------- | ----------------------------------------------------- |
| Recovery Readiness   | HRV, sleep quality, rest days                         |
| Activity Load        | Exercise intensity, frequency, strain                 |
| Sleep Stability      | Sleep timing consistency, depth, wake-ups             |
| Heart Rhythm Balance | Resting heart rate vs active, variability             |
| Consistency          | Regularity across sleep, workouts, recovery behaviors |

---

## 🤖 LLM Archetype Generation Prompt

Used to generate name, description, image style, and sliders.

> SYSTEM PROMPT:

```
You are a personality designer generating unique health archetypes based on biometric and lifestyle data. These are not diagnoses — they're symbolic digital profiles, expressed visually and narratively.

For each user, generate:

1. Archetype Name (max 3 words, title case)
2. Archetype Description: A 1–2 sentence summary of the person's health "vibe" and strengths
3. A low-poly image prompt: Describe a digital character in a stylized polygonal art style. Human character, geometric features, bold lighting and colors. Include scene/background. Avoid realism or animals.
4. Slider values (0–100) for the following 5 health traits:
   - Recovery Readiness
   - Activity Load
   - Sleep Stability
   - Heart Rhythm Balance
   - Consistency

Style references: Symbolic, expressive, vibrant low-poly avatars. No logos or brand names.
```

---

## 🔗 Shareability

- No URLs or persistent links
- User can **copy/download their archetype card** as an image
- Optional name appears on card
- Uses `html-to-image` or `dom-to-image` library to capture DOM node

---

## 🧱 Tech Stack

### Frontend

| Tool             | Purpose                            |
| ---------------- | ---------------------------------- |
| React (via Vite) | Component rendering                |
| Tailwind CSS     | Styling                            |
| Chakra UI        | Beautiful accessible UI components |
| html-to-image    | Export card as image               |

### Backend

| Tool              | Purpose                          |
| ----------------- | -------------------------------- |
| Node.js (Express) | Hosts API endpoints locally      |
| OpenAI API        | LLM + image generation           |
| In-memory JSON    | Holds session data (no database) |
| Terra API         | Pulls user health metrics        |

### Data Handling

- No persistent database
- All data is held in RAM (temporary JSON object)
- Deleted after archetype is shown

---

## 🧪 Terra Data Strategy

Use Terra's standard normalized health metrics from:

- `/daily`: sleep, heart rate, activity levels
- `/activity`: workouts, intensity
- `/sleep`: detailed sleep trends
- `/body`: body comp if available
- Fetch 30–90 days of data

> You only need enough data to extract a stable health profile. No deep historical processing needed.

---

## 🔒 Privacy & Data Ephemerality

- All processing is done in memory
- No data persisted to disk or external services
- Data wiped after archetype generation
- User sessions are non-identifiable

---

## 📁 Folder Structure

This is the recommended layout for organizing the local full-stack app:

```
health-archetypes-demo/
│
├── client/                     # Frontend (React + Chakra UI)
│   ├── public/                 # Static assets (favicons, index.html)
│   ├── src/
│   │   ├── assets/             # Images, icons, fonts
│   │   ├── components/         # Reusable UI components (e.g. SliderCard, Stepper)
│   │   ├── pages/              # Top-level views (LandingPage, ArchetypePage)
│   │   ├── hooks/              # Custom React hooks (e.g. useTerraConnect, useStepper)
│   │   ├── utils/              # Frontend utilities (e.g. formatter, imageExport)
│   │   ├── theme/              # Chakra UI theme extensions
│   │   ├── App.tsx
│   │   └── main.tsx
│   └── vite.config.ts
│
├── server/                     # Backend (Node.js + Express)
│   ├── routes/                 # API route handlers (e.g. /archetype, /terra)
│   ├── services/               # LLM, image gen, and Terra data handlers
│   ├── utils/                  # Shared helpers (e.g. sessionManager, dataParser)
│   ├── index.ts                # Express app entry point
│   └── types.ts                # Shared TypeScript types (for LLM prompt, etc.)
│
├── shared/                     # Common code (shared between client/server if needed)
│   └── constants.ts            # Shared enums, prompt strings, slider names
│
├── .env                        # API keys (OpenAI, Terra) – local only
├── package.json                # Root-level dependencies and scripts
├── tsconfig.json               # TypeScript config
└── README.md                   # Project setup and run instructions
```

---

## 📝 Implementation Notes & Considerations

- **Terra API Synchronous Data Fetching:** When fetching historical data using `to_webhook=false` (to get data directly in the API response), request shorter date ranges (e.g., **28 days or less**). Longer ranges may cause Terra to respond with a "Large request submitted" message, indicating asynchronous processing which cannot be handled without a publicly accessible webhook endpoint.
- **Terra API Response Parsing:** The structure of JSON responses from Terra API endpoints (like `/daily`, `/sleep`, etc.) can vary. Ensure parsing logic (e.g., in the backend's `fetchTerraData` function) correctly handles potential nesting, typically looking for the data array within `response.data.data` or sometimes `response.data`, before defaulting to an empty array on error or unexpected structure.
- **Vite Dev Server Proxy:** When running the React frontend (Vite) and Node.js backend locally on different ports, configure Vite's `server.proxy` in `vite.config.ts` to forward API requests (e.g., `/api/*`) from the frontend to the backend server's port (e.g., `http://localhost:3000`). Remember to restart the Vite dev server after modifying the config.
- **Local Authentication Flow (No Webhooks):** The current simplified setup avoids external webhooks by having the frontend extract `user_id` from Terra's redirect URL and send it to a dedicated backend endpoint (`/api/terra/confirm-auth`) to associate it with the session ID. This relies on Terra consistently providing `user_id` in the success redirect parameters.

---

## ✅ MVP Milestones

### 📊 Terra Data Handling

- [X] Add API credentials to `.env` (Terra DEV_ID, API_KEY)
- [X] Implement backend logic for a local Terra widget authentication flow (no webhooks), including:
    - Session ID generation and management for the widget interaction.
    - Secure server-side call to Terra to obtain the widget session URL (embedding our `sessionId`).
    - A backend endpoint for the frontend to confirm `terraUserId` (obtained from Terra's redirect URL) against a `sessionId`, storing this mapping.
- [X] Develop backend services to:
    - Fetch a user's health data arrays (daily, sleep, activity, body) from the Terra API.
    - Package these data arrays into a unified JSON report, noting data availability.
- [X] Implement a backend mechanism to make the packaged health data report accessible via a session identifier.
- [X] Include basic fallback considerations for missing data categories in the health data report.
- [X] Implement temporary frontend page to test Terra data flow.

### 🧠 AI Archetype Generation

- [X] Create `/archetype` backend route
- [X] Construct system prompt (move to `shared/constants.ts`)
- [ ] Add OpenAI credentials to `.env`
- [ ] Implement OpenAI call with retries + error handling
- [ ] Return archetype name, description, image prompt, and sliders

### 🖼 Image Generation Pipeline

- [ ] Add backend call to OpenAI image endpoint with style prompt
- [ ] Stream or cache result for frontend display
- [ ] Normalize aspect ratio, resolution, and style
- [ ] Handle loading/error states gracefully on client

### 🖼 Frontend Flow – Frame by Frame

#### Landing Page

- [ ] Create `LandingPage.tsx` with CTA + minimal copy
- [ ] Integrate Terra Widget launch button
- [ ] Add privacy note ("local only, session deleted")

#### Progress Stepper

- [ ] Create `Stepper.tsx` UI component with 4 labeled states
- [ ] Animate progression between steps on data fetch
- [ ] Hook stepper into backend processing stages

#### Archetype Card Display

- [ ] Create `ArchetypeCard.tsx` with:

  - Archetype name + description
  - Image (OpenAI result)
  - Sliders with labels
  - Optional name input
  - Copy/download button

### 🎨 Image + Export Tools

- [ ] Implement `useImageExport()` custom hook
- [ ] Add `Copy My Archetype` CTA → exports `ArchetypeCard` to PNG
- [ ] Copy to clipboard or auto-download

### 🧼 Ephemeral Data Strategy

- [ ] Store user data in temporary memory object
- [ ] Add `deleteSessionData()` after card render or timeout
- [ ] Ensure no disk writes or API logging
- [ ] Add console/session logging in dev mode only

### ✅ Polishing & Finishing Touches

- [ ] Validate all inputs and UI states
- [ ] Add animation microinteractions (e.g. Framer Motion)
- [ ] Add fallback illustrations or placeholders
- [ ] Add favicon + site meta
- [ ] Test offline behavior and session cleanups
- [ ] Write concise README with local dev instructions
